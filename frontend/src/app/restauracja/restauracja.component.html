<div class="admin-container">
  <header class="admin-header">
    <div class="header-content">
      <h1>Panel zarządzania</h1>
      <p class="header-subtitle">Twoje restauracje</p>
    </div>
    <div class="header-actions">
      <button pButton class="btn-outline" (click)="getRestaurant()">
        <i class="pi pi-refresh"></i>
        Odśwież
      </button>
      <button pButton class="btn-primary" (click)="addingDialog = true">
        <i class="pi pi-plus"></i>
        Dodaj restaurację
      </button>
    </div>
  </header>

  <div class="restaurants-list" *ngIf="restauracje.length > 0">
    <article *ngFor="let restaurant of restauracje" class="restaurant-card">
      
      <div class="card-image" *ngIf="getMainImage(restaurant) as img">
        <img [src]="'data:' + img.typ + ';base64,' + img.obrazBase64" [alt]="restaurant.nazwa" />
      </div>
      <div class="card-image card-placeholder" *ngIf="!getMainImage(restaurant)">
        <i class="pi pi-image"></i>
      </div>

      <div class="card-body">
        <h3 class="card-title">{{ restaurant.nazwa }}</h3>
        
        <div class="card-info">
          <div class="info-item">
            <i class="pi pi-map-marker"></i>
            <span>{{ restaurant.adres }}</span>
          </div>
          <div class="info-item" *ngIf="restaurant.nr_kontaktowy">
            <i class="pi pi-phone"></i>
            <span>{{ restaurant.nr_kontaktowy }}</span>
          </div>
          <div class="info-item" *ngIf="restaurant.email">
            <i class="pi pi-envelope"></i>
            <span>{{ restaurant.email }}</span>
          </div>
        </div>

        <div class="card-actions">
          <button pButton class="btn-edit" (click)="openEditDialog(restaurant)">
            <i class="pi pi-pencil"></i>
            Edytuj
          </button>
        </div>
      </div>
    </article>
  </div>

  <div *ngIf="restauracje.length === 0" class="empty-state">
    <div class="empty-icon">
      <i class="pi pi-building"></i>
    </div>
    <h3>Brak restauracji</h3>
    <p>Dodaj pierwszą restaurację, aby rozpocząć</p>
    <button pButton class="btn-primary" (click)="addingDialog = true">
      <i class="pi pi-plus"></i>
      Dodaj restaurację
    </button>
  </div>
</div>

<!-- Dialog dodawania -->
<p-dialog [(visible)]="addingDialog" [header]="'Nowa restauracja'" [modal]="true" [styleClass]="'admin-dialog'">
  <ng-template pTemplate="content">
    <div class="dialog-form">
      <div class="form-field">
        <label>Nazwa restauracji</label>
        <input type="text" pInputText [(ngModel)]="newRestaurant.nazwa" placeholder="Nazwa" />
      </div>
      <div class="form-field">
        <label>Adres</label>
        <input type="text" pInputText [(ngModel)]="newRestaurant.adres" placeholder="ul. Przykładowa 1, Warszawa" />
      </div>
      <div class="form-row">
        <div class="form-field">
          <label>Telefon</label>
          <input type="text" pInputText [(ngModel)]="newRestaurant.nr_kontaktowy" placeholder="123 456 789" />
        </div>
        <div class="form-field">
          <label>Email</label>
          <input type="email" pInputText [(ngModel)]="newRestaurant.email" placeholder="kontakt@restauracja.pl" />
        </div>
      </div>
      <div class="form-field">
        <label>Zdjęcia</label>
        <p-fileUpload 
          name="images[]" 
          mode="advanced"
          [multiple]="true" 
          accept="image/*" 
          [maxFileSize]="5000000"
          [showUploadButton]="false" 
          [showCancelButton]="true"
          chooseLabel="Wybierz zdjęcia"
          cancelLabel="Wyczyść"
          (onSelect)="onNewFilesSelected($event)">
        </p-fileUpload>
      </div>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <button pButton label="Anuluj" class="btn-secondary" (click)="addingDialog = false"></button>
    <button pButton label="Zapisz" class="btn-primary" (click)="saveRestaurant()"></button>
  </ng-template>
</p-dialog>

<!-- Dialog edycji -->
<p-dialog [(visible)]="editingDialog" [header]="'Edytuj restaurację'" [modal]="true" [styleClass]="'admin-dialog'">
  <ng-template pTemplate="content">
    <div class="dialog-form">
      <div class="form-field">
        <label>Nazwa restauracji</label>
        <input type="text" pInputText [(ngModel)]="editedRestaurant.nazwa" />
      </div>
      <div class="form-field">
        <label>Adres</label>
        <input type="text" pInputText [(ngModel)]="editedRestaurant.adres" />
      </div>
      <div class="form-row">
        <div class="form-field">
          <label>Telefon</label>
          <input type="text" pInputText [(ngModel)]="editedRestaurant.nr_kontaktowy" />
        </div>
        <div class="form-field">
          <label>Email</label>
          <input type="email" pInputText [(ngModel)]="editedRestaurant.email" />
        </div>
      </div>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <button pButton label="Anuluj" class="btn-secondary" (click)="editingDialog = false"></button>
    <button pButton label="Zapisz zmiany" class="btn-primary" (click)="updateRestaurant()"></button>
  </ng-template>
</p-dialog>

<!-- Dialog układu sali -->
<app-reservation-dialog
  [(visible)]="floorPlanDialogVisible"
  [restaurantName]="currentRestaurantForLayout?.nazwa || ''"
  [isEditable]="true"
  (layoutSaved)="onLayoutSaved($event)">
</app-reservation-dialog>